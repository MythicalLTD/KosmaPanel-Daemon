<VirtualHost *:80>
  ServerName <domain>

  RewriteEngine On
  RewriteCond %{HTTPS} !=on
  RewriteRule ^/?(.*) https://%{SERVER_NAME}/$1 [R,L]
</VirtualHost>

<VirtualHost *:443>
  ServerName <domain>
  ProxyPreserveHost On

  ProxyPass / http://<ip>:<port>/
  ProxyPassReverse / http://<ip>:<port>/

  ProxyPass /ws/ ws://<ip>:<port>/ws/
  ProxyPassReverse /ws/ ws://<ip>:<port>/ws/

  RewriteEngine On
  RewriteCond %{HTTP:Upgrade} =websocket [NC]
  RewriteRule /(.*) ws://<ip>:<port>/$1 [P,L]

  SSLEngine on
  SSLCertificateFile /etc/letsencrypt/live/<domain>/fullchain.pem
  SSLCertificateKeyFile /etc/letsencrypt/live/<domain>/privkey.pem
</VirtualHost>