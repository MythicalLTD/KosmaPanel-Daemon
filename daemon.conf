<VirtualHost *:80>
  ServerName url

  RewriteEngine On
  RewriteCond %{HTTPS} !=on
  RewriteRule ^/?(.*) https://%{SERVER_NAME}/$1 [R,L]
</VirtualHost>

<VirtualHost *:443>
  ServerName url
  ProxyPreserveHost On

  ProxyPass / http://127.0.0.1:5001/
  ProxyPassReverse / http://127.0.0.1:5001/

  ProxyPass /ws/ ws://127.0.0.1:5001/ws/
  ProxyPassReverse /ws/ ws://127.0.0.1:5001/ws/

  RewriteEngine On
  RewriteCond %{HTTP:Upgrade} =websocket [NC]
  RewriteRule /(.*) ws://127.0.0.1:5001/$1 [P,L]

  SSLEngine on
  SSLCertificateFile /etc/letsencrypt/live/url/fullchain.pem
  SSLCertificateKeyFile /etc/letsencrypt/live/url/privkey.pem
</VirtualHost>